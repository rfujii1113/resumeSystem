<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Resume Form</title>
    <link rel="stylesheet" th:href="@{/css/resumeForm.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="/js/resumeForm.js" defer></script>
</head>

<body>
    <div th:insert="~{navbar :: navbar}"></div>
    <div th:insert="~{sidebar :: sidebar}"></div>
    <div class="container a4-container">
        <div class="header">
            <!-- キャンセルボタンを左側に追加 -->
            <a th:href="@{/resume/view(userId=${resumeDto.userInfo.userId})}" class="cancel-button"
                onclick="return confirm('変更を保存せずに戻りますか？');">戻る</a>
            <!-- 保存ボタン -->
            <button type="submit" form="resume-form" class="save-button">保存</button>
        </div>

        <form id="resume-form" th:action="@{/resume/save}" th:object="${resumeDto}" method="post">
            <!-- ユーザーIDを送信するためのhidden input -->
            <input type="hidden" th:field="*{userInfo.userId}" />

            <!-- Personal Information Section -->
            <section class="personal-info">
                <h2>個人情報</h2>
                <div class="input-group">
                    <label>
                        名前(漢字)
                        <input type="text" th:field="*{userInfo.userName}" placeholder="" required>
                    </label>
                    <label>
                        名前(ローマ字)
                        <input type="text" th:field="*{userInfo.userNameRomaji}" placeholder="" required>
                    </label>
                    <label>
                        性別
                        <select th:field="*{userInfo.gender}" required>
                            <option value="false">男性</option>
                            <option value="true">女性</option>
                        </select>
                    </label>
                    <label>
                        生年月日
                        <input type="date" th:field="*{userInfo.birthDate}" required>
                    </label>
                    <label>
                        本籍
                        <input type="text" th:field="*{userInfo.permanentAddress}" placeholder="">
                    </label>
                    <label>
                        配偶者
                        <select th:field="*{userInfo.spou+e}">
                            <option value="false">無</option>
                            <option value="true">有</option>
                        </select>
                    </label>
                </div>
                <div class="input-group">
                    <label>
                        現住所
                        <input type="text" th:field="*{userInfo.currentAddress}" placeholder="">
                    </label>
                    <label>
                        最寄り駅
                        <input type="text" th:field="*{userInfo.nearestStation}" placeholder="">
                    </label>
                </div>
            </section>

            <!-- Education Section -->
            <section class="education">
                <h2>学歴</h2>
                <div class="input-group">
                    <label>
                        区分
                        <select th:field="*{userInfo.lastSchoolType}">
                            <option value="4年制">4年制</option>
                            <option value="2年制">2年制</option>
                        </select>
                    </label>
                    <label>
                        学校名
                        <input type="text" th:field="*{userInfo.lastSchool}" placeholder="">
                    </label>
                    <label>
                        卒業年月
                        <input type="date" th:field="*{userInfo.graduationDate}" required>
                    </label>
                    <label>
                        専攻名
                        <input type="text" th:field="*{userInfo.major}" placeholder="">
                    </label>
                </div>
            </section>

            <!-- Experience Sections -->
            <section class="experience">
                <h2>経験</h2>
                <div id="experience-sections">
                    <!-- Project Item -->
                    <section class="experience-item" data-index="0">
                        <div class="input-group">
                            <label>
                                プロジェクト名
                                <input type="text" th:field="*{projects[0].projectName}" name="projects[0].projectName" placeholder="" />
                            </label>
                            <label>
                                作業場所
                                <input type="text" th:field="*{projects[0].location}" name="projects[0].location" placeholder="" />
                            </label>
                            <label>
                                開始日
                                <input type="date" th:field="*{projects[0].startDate}" name="projects[0].startDate" required />
                            </label>
                            <label>
                                終了日
                                <input type="date" th:field="*{projects[0].endDate}" name="projects[0].endDate" required />
                            </label>
                        </div>
                        <!-- unique project id を保存-->
                        <input type="hidden" name="projects[0].projectId" id="projects[0].projectId" value="" />

                        <!-- Process -->
                        <div class="input-group">
                            <label>
                                Ａ：調査分析 Ｂ：基本設計 Ｃ：詳細設計 Ｄ：製造単体 Ｅ：結合試験 Ｆ：総合テスト G : 保守運用
                                <div class="process-chips" id="process-chips-0-processes">
                                    <span class="process-chip">A</span>
                                    <span class="process-chip">B</span>
                                    <span class="process-chip">C</span>
                                    <span class="process-chip">D</span>
                                    <span class="process-chip">E</span>
                                    <span class="process-chip">F</span>
                                    <span class="process-chip">G</span>
                                </div>
                                <input type="hidden" name="projects[0].processes" id="projects[0].processes">
                            </label>
                        </div>

                        <!-- Skill -->
                        <div class="input-group tech">
                            <label class="skill-label">
                                OS
                                <div class="selected-skills-list" id="selected-skills-0-os"></div>
                                <input type="hidden" name="projects[0].os" id="projects[0].os">
                            </label>
                            <label class="skill-label">
                                DB
                                <div class="selected-skills-list" id="selected-skills-0-db"></div>
                                <input type="hidden" name="projects[0].db" id="projects[0].db">
                            </label>
                            <label class="skill-label">
                                Language
                                <div class="selected-skills-list" id="selected-skills-0-language"></div>
                                <input type="hidden" name="projects[0].language" id="projects[0].language">
                            </label>
                            <label class="skill-label">
                                Tools
                                <div class="selected-skills-list" id="selected-skills-0-tool"></div>
                                <input type="hidden" name="projects[0].tool" id="projects[0].tool">
                            </label>
                            <button type="button" class="skill-add-button" data-index="0">スキル追加</button>
                        </div>

                        <div class="responsibility">
                            <textarea th:field="*{projects[0].responsibility}" name="projects[0].responsibility" placeholder="担当した業務を簡単に記入してください。" maxlength="500"
                                style="overflow: hidden; resize: none;"></textarea>
                        </div>
                    </section>
                </div>

                <!-- 경력 추가 버튼 -->
                <button type="button" class="history-add-button">+ プロジェクト追加</button>
            </section>

            <!-- Summary Section -->
            <section class="summary">
                <h2>自己PR</h2>
                <div class="input-group">
                    <label>
                        自己PR
                        <textarea th:field="*{userInfo.selfPr}" placeholder="簡単に自己PRしてください。"
                            style="overflow: hidden; resize: none;"></textarea>
                    </label>
                </div>
            </section>
        </form>

        <!-- Skill Popup Modal -->
        <div id="skill-popup" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>スキル追加</h2>
                <!-- スキルカテゴリ -->
                <div th:each="category : ${skillsByCategory}">
                    <div class="skill-category">
                        <h3 th:text="${category.key}"></h3>
                        <div class="skill-chips" th:each="skill : ${category.value}">
                            <span class="skill-chip" th:text="${skill.name}" th:attr="data-category=${category.key}"></span>
                        </div>
                    </div>
                </div>
                <button type="button" class="apply-button">適用</button>
            </div>
        </div>

    </div>
</body>

</html>
